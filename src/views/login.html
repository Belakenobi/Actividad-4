<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventario RPG - Gesti√≥n de Items</title>
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0a0a0f;
      --bg-card: #151520;
      --bg-input: #1a1a28;
      --text-primary: #e8e6e3;
      --text-secondary: #9d9a95;
      --common: #9d9a95;
      --rare: #3498db;
      --epic: #9b59b6;
      --legendary: #f39c12;
      --accent: #c9a227;
      --danger: #e74c3c;
      --success: #27ae60;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Cinzel', serif;
      background: var(--bg-dark);
      min-height: 100vh;
      background-image: 
        radial-gradient(ellipse at top, #1a1525 0%, transparent 50%),
        radial-gradient(ellipse at bottom, #0d1117 0%, transparent 50%);
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    .auth-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .login-box {
      background: var(--bg-card);
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 40px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 0 40px rgba(201, 162, 39, 0.15), inset 0 0 60px rgba(0,0,0,0.3);
    }

    .login-box h1 {
      font-family: 'MedievalSharp', cursive;
      color: var(--accent);
      text-align: center;
      margin-bottom: 30px;
      font-size: 2rem;
      text-shadow: 0 0 20px rgba(201, 162, 39, 0.5);
    }

    .login-box h1::before { content: '‚öî '; }
    .login-box h1::after { content: ' ‚öî'; }

    .tabs {
      display: flex;
      margin-bottom: 25px;
      border-bottom: 1px solid #333;
    }

    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      color: var(--text-secondary);
      transition: all 0.3s;
      font-weight: 700;
      letter-spacing: 1px;
    }

    .tab.active {
      color: var(--accent);
      border-bottom: 2px solid var(--accent);
    }

    .form-container { display: none; }
    .form-container.active { display: block; }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
      font-size: 0.85rem;
      letter-spacing: 1px;
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 12px 15px;
      background: var(--bg-input);
      border: 1px solid #333;
      border-radius: 6px;
      color: var(--text-primary);
      font-family: 'Cinzel', serif;
      font-size: 0.95rem;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 15px rgba(201, 162, 39, 0.2);
    }

    button {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--accent), #a88420);
      color: var(--bg-dark);
      border: none;
      border-radius: 6px;
      font-family: 'MedievalSharp', cursive;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(201, 162, 39, 0.4);
    }

    .message {
      padding: 12px;
      margin-bottom: 20px;
      border-radius: 6px;
      display: none;
      text-align: center;
    }

    .message.success { background: rgba(39, 174, 96, 0.2); color: var(--success); display: block; }
    .message.error { background: rgba(231, 76, 60, 0.2); color: var(--danger); display: block; }

    .hidden { display: none !important; }

    .app-view { padding: 20px; }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--accent);
    }

    .header h1 {
      font-family: 'MedievalSharp', cursive;
      color: var(--accent);
      font-size: 1.8rem;
      text-shadow: 0 0 15px rgba(201, 162, 39, 0.5);
    }

    .logout-btn {
      width: auto;
      padding: 10px 20px;
      background: var(--danger);
      font-size: 0.9rem;
    }

    .item-form {
      background: var(--bg-card);
      border: 1px solid #333;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 30px;
    }

    .item-form h2 {
      color: var(--text-primary);
      margin-bottom: 20px;
      font-family: 'MedievalSharp', cursive;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 15px;
    }

    .form-row-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    .item-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #333;
    }

    .item-stats .form-group { margin-bottom: 0; }

    .inventory-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .item-card {
      background: var(--bg-card);
      border-radius: 10px;
      padding: 20px;
      position: relative;
      transition: transform 0.3s, box-shadow 0.3s;
      overflow: hidden;
    }

    .item-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
    }

    .item-card.rarity-com√∫n::before { background: var(--common); }
    .item-card.rarity-raro::before { background: var(--rare); box-shadow: 0 0 15px var(--rare); }
    .item-card.rarity-√©pico::before { background: var(--epic); box-shadow: 0 0 20px var(--epic); }
    .item-card.rarity-legendario::before { background: var(--legendary); box-shadow: 0 0 25px var(--legendary); }

    .item-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    .item-name {
      font-family: 'MedievalSharp', cursive;
      font-size: 1.2rem;
      color: var(--text-primary);
    }

    .item-rarity {
      font-size: 0.7rem;
      padding: 4px 10px;
      border-radius: 20px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: bold;
    }

    .rarity-com√∫n .item-rarity { background: rgba(157, 154, 149, 0.2); color: var(--common); }
    .rarity-raro .item-rarity { background: rgba(52, 152, 219, 0.2); color: var(--rare); }
    .rarity-√©pico .item-rarity { background: rgba(155, 89, 182, 0.2); color: var(--epic); }
    .rarity-legendario .item-rarity { background: rgba(243, 156, 18, 0.2); color: var(--legendary); }

    .item-type {
      color: var(--text-secondary);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 10px;
    }

    .item-description {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-bottom: 15px;
      font-style: italic;
    }

    .item-stats-display {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
      padding: 10px;
      background: var(--bg-input);
      border-radius: 6px;
    }

    .stat { text-align: center; flex: 1; }

    .stat-value {
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--accent);
    }

    .stat-label {
      font-size: 0.65rem;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    .item-price {
      font-size: 1.3rem;
      color: var(--legendary);
      margin-bottom: 15px;
      font-family: 'MedievalSharp', cursive;
    }

    .item-price::before { content: 'üí∞ '; }

    .item-actions { display: flex; gap: 10px; }

    .item-actions button {
      flex: 1;
      padding: 8px;
      font-size: 0.8rem;
      font-family: 'Cinzel', serif;
    }

    .btn-edit { background: var(--rare); }
    .btn-delete { background: var(--danger); }

    .cancel-btn {
      margin-top: 10px;
      background: #444 !important;
    }

    .empty-inventory {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-inventory::before {
      content: 'üéí';
      font-size: 4rem;
      display: block;
      margin-bottom: 20px;
    }

    .filter-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .filter-bar select {
      padding: 10px 15px;
      background: var(--bg-card);
      border: 1px solid #333;
      border-radius: 6px;
      color: var(--text-primary);
      font-family: 'Cinzel', serif;
      cursor: pointer;
    }

max-width:     @media (768px) {
      .form-row, .item-stats { grid-template-columns: 1fr; }
      .inventory-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="auth-container" id="auth-container">
    <div class="login-box">
      <h1>Inventario RPG</h1>
      <div class="message" id="message"></div>
      <div class="tabs">
        <div class="tab active" onclick="switchTab('login')">Iniciar Sesi√≥n</div>
        <div class="tab" onclick="switchTab('register')">Registrarse</div>
      </div>
      
      <div class="form-container active" id="login-form">
        <form onsubmit="handleLogin(event)">
          <div class="form-group">
            <label for="login-email">Email</label>
            <input type="email" id="login-email" required>
          </div>
          <div class="form-group">
            <label for="login-password">Contrase√±a</label>
            <input type="password" id="login-password" required>
          </div>
          <button type="submit">Entrar</button>
        </form>
      </div>

      <div class="form-container" id="register-form">
        <form onsubmit="handleRegister(event)">
          <div class="form-group">
            <label for="register-username">Nombre de Aventurero</label>
            <input type="text" id="register-username" required>
          </div>
          <div class="form-group">
            <label for="register-email">Email</label>
            <input type="email" id="register-email" required>
          </div>
          <div class="form-group">
            <label for="register-password">Contrase√±a</label>
            <input type="password" id="register-password" required>
          </div>
          <button type="submit">Crear Personaje</button>
        </form>
      </div>
    </div>
  </div>

  <div class="container hidden" id="app-view">
    <div class="app-view">
      <div class="header">
        <h1>üéí Mi Inventario</h1>
        <button class="logout-btn" onclick="handleLogout()">Salir</button>
      </div>

      <div class="item-form">
        <h2 id="form-title">‚ûï Nuevo Item</h2>
        <form onsubmit="handleProductSubmit(event)">
          <input type="hidden" id="product-id">
          <div class="form-row">
            <div class="form-group">
              <label for="product-name">Nombre del Item</label>
              <input type="text" id="product-name" required>
            </div>
            <div class="form-group">
              <label for="product-category">Tipo</label>
              <select id="product-category">
                <option value="material">Material</option>
                <option value="arma">Arma</option>
                <option value="armadura">Armadura</option>
                <option value="poci√≥n">Poci√≥n</option>
                <option value="accesorio">Accesorio</option>
              </select>
            </div>
            <div class="form-group">
              <label for="product-rarity">Rareza</label>
              <select id="product-rarity">
                <option value="com√∫n">Com√∫n</option>
                <option value="raro">Raro</option>
                <option value="√©pico">√âpico</option>
                <option value="legendario">Legendario</option>
              </select>
            </div>
          </div>
          <div class="form-row-2">
            <div class="form-group">
              <label for="product-price">Precio (oro)</label>
              <input type="number" id="product-price" min="0" required>
            </div>
            <div class="form-group">
              <label for="product-stock">Cantidad</label>
              <input type="number" id="product-stock" min="0" value="0">
            </div>
          </div>
          <div class="form-group">
            <label for="product-description">Descripci√≥n</label>
            <input type="text" id="product-description">
          </div>
          <div class="item-stats">
            <div class="form-group">
              <label for="product-damage">‚öî Da√±o</label>
              <input type="number" id="product-damage" min="0" value="0">
            </div>
            <div class="form-group">
              <label for="product-defense">üõ° Defensa</label>
              <input type="number" id="product-defense" min="0" value="0">
            </div>
            <div class="form-group">
              <label for="product-durability">üíé Durabilidad</label>
              <input type="number" id="product-durability" min="0" max="100" value="100">
            </div>
          </div>
          <button type="submit" id="submit-btn" style="margin-top: 15px;">Agregar al Inventario</button>
          <button type="button" id="cancel-btn" class="hidden cancel-btn" onclick="resetProductForm()">Cancelar</button>
        </form>
      </div>

      <div class="filter-bar">
        <select id="filter-category" onchange="loadProducts()">
          <option value="">Todos los tipos</option>
          <option value="material">Material</option>
          <option value="arma">Arma</option>
          <option value="armadura">Armadura</option>
          <option value="poci√≥n">Poci√≥n</option>
          <option value="accesorio">Accesorio</option>
        </select>
        <select id="filter-rarity" onchange="loadProducts()">
          <option value="">Todas las rarezas</option>
          <option value="com√∫n">Com√∫n</option>
          <option value="raro">Raro</option>
          <option value="√©pico">√âpico</option>
          <option value="legendario">Legendario</option>
        </select>
      </div>

      <div class="inventory-grid" id="product-list"></div>
    </div>
  </div>

  <script>
    let token = localStorage.getItem('token');
    let products = [];

    const typeIcons = {
      'arma': '‚öîÔ∏è',
      'armadura': 'üõ°Ô∏è',
      'poci√≥n': 'üß™',
      'accesorio': 'üíç',
      'material': 'üì¶'
    };

    if (token) {
      showApp();
      loadProducts();
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
      if (tab === 'login') {
        document.querySelector('.tab:first-child').classList.add('active');
        document.getElementById('login-form').classList.add('active');
      } else {
        document.querySelector('.tab:last-child').classList.add('active');
        document.getElementById('register-form').classList.add('active');
      }
      hideMessage();
    }

    function showMessage(text, type) {
      const msg = document.getElementById('message');
      msg.textContent = text;
      msg.className = `message ${type}`;
    }

    function hideMessage() {
      document.getElementById('message').className = 'message';
    }

    async function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;

      try {
        const res = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();

        if (data.success) {
          token = data.token;
          localStorage.setItem('token', token);
          showApp();
          loadProducts();
        } else {
          showMessage(data.message, 'error');
        }
      } catch (err) {
        showMessage('Error al conectar con el servidor', 'error');
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      const username = document.getElementById('register-username').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;

      try {
        const res = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, email, password })
        });
        const data = await res.json();

        if (data.success) {
          token = data.token;
          localStorage.setItem('token', token);
          showApp();
          loadProducts();
        } else {
          showMessage(data.message, 'error');
        }
      } catch (err) {
        showMessage('Error al conectar con el servidor', 'error');
      }
    }

    function handleLogout() {
      token = null;
      localStorage.removeItem('token');
      document.getElementById('auth-container').classList.remove('hidden');
      document.getElementById('app-view').classList.add('hidden');
      document.getElementById('login-email').value = '';
      document.getElementById('login-password').value = '';
    }

    function showApp() {
      document.getElementById('auth-container').classList.add('hidden');
      document.getElementById('app-view').classList.remove('hidden');
    }

    async function loadProducts() {
      const category = document.getElementById('filter-category').value;
      const rarity = document.getElementById('filter-rarity').value;
      
      let url = '/api/products?';
      if (category) url += `category=${category}&`;
      if (rarity) url += `rarity=${rarity}&`;

      try {
        const res = await fetch(url, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await res.json();
        
        if (data.success) {
          products = data.products;
          renderProducts();
        }
      } catch (err) {
        console.error('Error loading products:', err);
      }
    }

    function renderProducts() {
      const list = document.getElementById('product-list');
      
      if (products.length === 0) {
        list.innerHTML = '<div class="empty-inventory">Tu inventario est√° vac√≠o. ¬°Agrega tu primer item!</div>';
        return;
      }

      list.innerHTML = products.map(p => `
        <div class="item-card rarity-${p.rarity}">
          <div class="item-header">
            <div class="item-name">${typeIcons[p.category] || 'üì¶'} ${p.name}</div>
            <span class="item-rarity">${p.rarity}</span>
          </div>
          <div class="item-type">${p.category}</div>
          <div class="item-description">${p.description || 'Sin descripci√≥n'}</div>
          <div class="item-stats-display">
            ${p.damage > 0 ? `<div class="stat"><div class="stat-value">${p.damage}</div><div class="stat-label">Da√±o</div></div>` : ''}
            ${p.defense > 0 ? `<div class="stat"><div class="stat-value">${p.defense}</div><div class="stat-label">Defensa</div></div>` : ''}
            <div class="stat"><div class="stat-value">${p.durability}</div><div class="stat-label">Durabilidad</div></div>
          </div>
          <div class="item-price">${p.price} oro</div>
          <div class="item-actions">
            <button class="btn-edit" onclick="editProduct('${p._id}')">Editar</button>
            <button class="btn-delete" onclick="deleteProduct('${p._id}')">Eliminar</button>
          </div>
        </div>
      `).join('');
    }

    async function handleProductSubmit(e) {
      e.preventDefault();
      const id = document.getElementById('product-id').value;
      const name = document.getElementById('product-name').value;
      const description = document.getElementById('product-description').value;
      const price = parseFloat(document.getElementById('product-price').value);
      const category = document.getElementById('product-category').value;
      const rarity = document.getElementById('product-rarity').value;
      const stock = parseInt(document.getElementById('product-stock').value);
      const damage = parseInt(document.getElementById('product-damage').value);
      const defense = parseInt(document.getElementById('product-defense').value);
      const durability = parseInt(document.getElementById('product-durability').value);

      const productData = { name, description, price, category, rarity, stock, damage, defense, durability };
      const url = id ? `/api/products/${id}` : '/api/products';
      const method = id ? 'PUT' : 'POST';

      try {
        const res = await fetch(url, {
          method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(productData)
        });
        const data = await res.json();

        if (data.success) {
          resetProductForm();
          loadProducts();
        } else {
          alert(data.message);
        }
      } catch (err) {
        console.error('Error saving product:', err);
      }
    }

    function editProduct(id) {
      const product = products.find(p => p._id === id);
      if (!product) return;

      document.getElementById('product-id').value = product._id;
      document.getElementById('product-name').value = product.name;
      document.getElementById('product-description').value = product.description || '';
      document.getElementById('product-price').value = product.price;
      document.getElementById('product-category').value = product.category;
      document.getElementById('product-rarity').value = product.rarity;
      document.getElementById('product-stock').value = product.stock;
      document.getElementById('product-damage').value = product.damage || 0;
      document.getElementById('product-defense').value = product.defense || 0;
      document.getElementById('product-durability').value = product.durability || 100;
      
      document.getElementById('form-title').textContent = '‚úèÔ∏è Editar Item';
      document.getElementById('submit-btn').textContent = 'Actualizar';
      document.getElementById('cancel-btn').classList.remove('hidden');
      window.scrollTo(0, 0);
    }

    function resetProductForm() {
      document.getElementById('product-id').value = '';
      document.getElementById('product-name').value = '';
      document.getElementById('product-description').value = '';
      document.getElementById('product-price').value = '';
      document.getElementById('product-category').value = 'material';
      document.getElementById('product-rarity').value = 'com√∫n';
      document.getElementById('product-stock').value = '0';
      document.getElementById('product-damage').value = '0';
      document.getElementById('product-defense').value = '0';
      document.getElementById('product-durability').value = '100';
      
      document.getElementById('form-title').textContent = '‚ûï Nuevo Item';
      document.getElementById('submit-btn').textContent = 'Agregar al Inventario';
      document.getElementById('cancel-btn').classList.add('hidden');
    }

    async function deleteProduct(id) {
      if (!confirm('¬øEst√°s seguro de eliminar este item?')) return;

      try {
        const res = await fetch(`/api/products/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await res.json();

        if (data.success) {
          loadProducts();
        }
      } catch (err) {
        console.error('Error deleting product:', err);
      }
    }
  </script>
</body>
</html>
